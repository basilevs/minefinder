<doctype html>
<html>
<body>
<p>Играть в Сапера, компьютерную игру из стандартной поставки Windows, не самый лучший способ провести время (особенно вечер выходного). После очередного заваленного из-за элементарной ошибки уровня появилось понимание - надо или повышать внимательность или автоматизировать процесс. Первое ремонту уже не подлежало.
<h1>Окна</h1>
<p> В детстве мне доводилось иметь дело с WinAPI и я вспомнил, что большая часть объектов в Windows представляет собой окно, адресуемое дескриптором HWND (знаковое целое замаскировалось). Не было бы проблемой захватить окно, найти в нем кнопочки с минами (кнопки - тоже окна, привет от Microsoft), <a href ="http://msdn.microsoft.com/en-us/library/windows/desktop/ms633520%28v=vs.85%29.aspx">прочитать их текст</a> и разобраться, какая информация есть в открытых ячейках (что-то мне подсказывало, что закрытые ячейки читаются не хуже, но я его старался не слушать)
<p>К сожалению, с возрастом интересы меняются, и любимый язык уже не C на котором весело игралось с WinAPI, а <a href="http://www.scala-lang.org/node/25">Scala</a>. Сожаление вызвано "величественной неторопливостью и здоровым аппетитом при работе с оперативной памятью" унаследованными этим языком от Java вместе с JVM (Scala еще в байткод .NET умеет компилировать, но его мне хватает на работе).
<p>Разобрать жалкое окошко 30x16 элементов средствами высокоуровневой Java? Нет ничего проще, богатство бибилиотек восхваляется на каждом углу!
<ul>
<li> библиотека для работы с Windows окнами и контролами... не на первых трех страницах Google
<li> Java и Winapi? Пучины JNI (Java С API) - последнее дело нырять туда на выходных.
<li> все дороги ведут на <a href="http://stackoverflow.com/questions/1173926/java-jni-jna-get-window-title">Stackoverflow</a> рекомендующий <a href="http://twall.github.com/jna/3.4.0/javadoc/overview-summary.html">JNA</a>
</ul>

<p>JNA стоит того чтобы рассказать о нём чуть подробнее. Это не слишком производительный способ вызвать произвольную C функцию из произвольной динамической билиотеки на множестве ОС. Позволяет описывать сигнатуру и даже calling convention средствами исключительно самой Java. С структуры - превращаются в Java классы, С коллбэки в интерфейсы, даже указатели типобезопасно преобразуются в объекты (утекать они, конечно, не разучились). Достигается это с помощью рефлекшена ещё рефлекшена и небольшой dll c JNI, которая спрятана достаточно глубоко, чтобы не вызывать священного ужаса у C-фобов. В комплекте идут примеры работы с основными нативными библиотеками Linux и Windows.

<p> Примеры покрывают лишь малую часть WinAPI, но их достаточно чтобы без проблем взять окно, забрать его детей... и обнаружить, что внуки куда-то спрятались! Кнопочки и циферки подло нарисованы в GDI+ и не имеют индивидуально ассоциированных окошек! GDI+ - интерфейс позволяющий виндовым приложениям рисовать на экране всякую чепуховую графику не давая ядру позаботиться о логике её работы - линии и точки на экране и я даже не знаю как перехватить их отрисовку...


</body>
</html>